ðŸ”§ NÃºcleo universal (vale para casi todo)
1) SYN externos (ECN-safe)

Detecta aperturas de conexiÃ³n salientes (candidatos a C2). Ajusta tu(s) rangos LAN.

(tcp.flags.syn == 1 and tcp.flags.ack == 0)
and !(ip.dst == 10.0.0.0/8 or ip.dst == 172.16.0.0/12 or ip.dst == 192.168.0.0/16)


Ãšsalo: para ver quiÃ©n toca a Internet.
EvÃ­talo: si solo quieres web: entonces filtra a 80/443 o aÃ±ade puertos.

2) SYN no-web (C2 en puertos raros)
(tcp.flags.syn == 1 and tcp.flags.ack == 0)
and !(tcp.port == 80 or tcp.port == 443)
and !(ip.dst == 10.0.0.0/8 or ip.dst == 172.16.0.0/12 or ip.dst == 192.168.0.0/16)


Ãšsalo: para priorizar C2 que no usan 80/443.
Limita: si el C2 sÃ­ usa 80/443 (no saldrÃ¡).

3) TCP con datos â€œno disecadosâ€
tcp.len > 0 and !(http or tls or ssh or smb2 or ftp or smtp or imap or pop)


Ãšsalo: para encontrar TCP crudo (p. ej., RedLine/STRRAT con net.tcp/WCF).
Ojo: tambiÃ©n verÃ¡s protocolos poco conocidos; hay que revisar streams.

4) Seguir un flujo sospechoso
tcp.stream == N and tcp.len > 0


Ãšsalo: lectura clara del payload (beaconing/exfil).
Opcionales:

tcp.stream == N and tcp.flags.push == 1
tcp.stream == N and tcp contains "tempuri.org"     # cambia por tu marcador


(PSH es â€œvista rÃ¡pidaâ€; no todos los stacks lo marcan siempre).

5) Firmas rÃ¡pidas de exfil de ficheros (hex)
frame contains 50:4B:03:04     # ZIP/Office (docx/xlsx/pptx)
frame contains 89:50:4E:47     # PNG
frame contains FF:D8:FF        # JPEG


Ãšsalo: para cazar capturas/archivos en streams C2.

ðŸŒ Web (HTTP/HTTPS/TLS)
Web bÃ¡sico
http or tls


Ãšsalo: timeline de staging (descargas en claro + ClientHello).

GET en claro
http.request.method == "GET"

TLS â€“ SNI, certificado y JA3 (metadatos)
tls.handshake.type == 1                              # ClientHello
tls.handshake.extensions_server_name                 # campo SNI
tls.handshake.extensions_server_name matches "(?i)(github|maven|pastebin|discord|telegram|dropbox)"


Ãšsalo: cuando todo estÃ¡ cifrado; tiras de metadatos.

HTTP/2 y HTTP/3 (QUIC)
http2 or (frame contains "PRI * HTTP/2.0")
quic or http3 or (udp.port == 443 and quic)

DNS cifrado
tcp.port == 853                 # DoT
udp.port == 853 and quic        # DoQ
(http or http2) and frame contains "dns-query"   # DoH

ðŸ“¦ DNS â€œnormalâ€
dns


Ãštil para ver dominios â†’ IP del host vÃ­ctima y pivoteo.

ðŸ“® Correo / robo vÃ­a email
smtp or imap or pop
frame contains "Content-Disposition: attachment"


Ãšsalo: si sospechas exfil por adjuntos/correo.

ðŸ–¥ï¸ Windows/AD
nbns                                   # hostname vÃ­ctima
kerberos.CNameString                   # usuario
ldap.AttributeDescription == "givenName"

ðŸ—„ï¸ SMB / RDP / SSH
smb2 and (smb2.cmd == 8 or smb2.cmd == 9)   # READ/WRITE (transferencias)
rdp or tcp.port == 3389
ssh


Ãšsalo: exfil lateral a shares o RDP interactivo.

ðŸ“¡ UDP/otros (tÃºneles y tiempo real)
stun or (udp.port == 3478 or udp.port == 5349)      # WebRTC/STUN
icmp and frame.len > 100                            # ICMP â€œgrandeâ€ (tÃºnel tosco)

ðŸ§­ CuÃ¡ndo usar cada uno (guÃ­a rÃ¡pida)

No sabes por dÃ³nde empezar:
http or tls â†’ mira staging;
+ SYN externos (uno de los filtros 1/2) â†’ candidatos C2.

C2 sospechoso localizado:
tcp.stream == N and tcp.len > 0 â†’ lee beaconing/exfil;
marcadores: tcp contains "tempuri.org" / firmas PNG/ZIP.

Todo va cifrado:
sin payload legible â†’ pivota a TLS/QUIC metadatos (SNI, JA3/horarios), DoH/DoT, dominios desde DNS.

Ves actividad de ficheros o escritorio remoto:
smb2 (READ/WRITE), rdp, ssh.

Sospecha de correo:
smtp/imap/pop + Content-Disposition.

Limitaciones (para no frustrarte)

Si el C2 usa 80/443, el filtro â€œSYN no-webâ€ no lo verÃ¡ (usa el SYN externo genÃ©rico).

PSH no es universal: si no aparece, tira de tcp.len > 0.

Cadenas partidas entre segmentos no casan con * contains "X" por paquete â†’ usa Follow TCP Stream.

QUIC/HTTP3 y gRPC/Protobuf pueden no mostrar strings: apÃ³yate en SNI, destinos, patrones temporales.
